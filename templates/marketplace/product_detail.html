{% extends 'base.html' %}
{% block title %}{{ product.title }} | LagosWebDev Marketplace{% endblock %}

{% block content %}
<div class="pd-wrap">

  <!-- Breadcrumb -->
  <section class="pd-breadcrumb py-3">
    <div class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item"><a href="{% url 'pages:home' %}">Home</a></li>
          <li class="breadcrumb-item"><a href="{% url 'marketplace:product_list' %}">Marketplace</a></li>
          <li class="breadcrumb-item active" aria-current="page">{{ product.title }}</li>
        </ol>
      </nav>
    </div>
  </section>

  <!-- HERO -->
  <section class="py-5">
    <div class="container">
      <div class="row g-4 align-items-start">

        <!-- Left: Preview -->
        <div class="col-lg-6">
          <div class="pd-preview">

            <div class="pd-main">
              {% if product.main_image %}
                <img src="{{ product.main_image.url }}" alt="{{ product.title }}" class="img-fluid">
              {% else %}
                <div class="pd-ph">
                  <i class="fas fa-laptop-code"></i>
                  <div class="mt-2">{{ product.title }}</div>
                </div>
              {% endif %}

              <div class="pd-badges">
                {% if product.is_featured %}
                  <span class="badge bg-danger"><i class="fas fa-star me-1"></i>Featured</span>
                {% endif %}
                {% if product.version %}
                  <span class="badge bg-dark"><i class="fas fa-code-branch me-1"></i>v{{ product.version }}</span>
                {% endif %}
              </div>
            </div>

            <!-- Small trust row -->
            <div class="pd-mini mt-3">
              <div class="mini-item">
                <i class="fas fa-check-circle"></i><span>Instant delivery</span>
              </div>
              <div class="mini-item">
                <i class="fas fa-shield-alt"></i><span>Secure checkout</span>
              </div>
              <div class="mini-item">
                <i class="fas fa-headset"></i><span>Support</span>
              </div>
            </div>

          </div>
        </div>

        <!-- Right: Details + Pricing -->
        <div class="col-lg-6">
          <div class="pd-details">

            <div class="pd-cat mb-3">
              <i class="fas fa-tag me-2"></i>{{ product.get_category_display }}
            </div>

            <h1 class="pd-title mb-3">{{ product.title }}</h1>

            <div class="pd-meta mb-4">
              {% if product.updated_at %}
              <span class="meta-pill">
                <i class="fas fa-clock me-2"></i>Updated {{ product.updated_at|timesince }} ago
              </span>
              {% endif %}
              {% if product.tech_stack %}
              <span class="meta-pill">
                <i class="fas fa-layer-group me-2"></i>{{ product.tech_stack }}
              </span>
              {% endif %}
            </div>

            <!-- Pricing cards -->
            <div class="row g-3">
              <!-- Full Ownership -->
              <div class="col-md-6">
                <div class="pd-price-card">
                  <div class="pc-ico"><i class="fas fa-code"></i></div>
                  <h4 class="mb-1">Full Ownership</h4>
                  <p class="small mb-3" style="color: var(--netflix-light-gray);">
                    Get full source code + docs.
                  </p>

                  <div class="pc-price">
                    ₦{{ product.price_full_ownership|floatformat:0 }}
                  </div>

                  <ul class="pc-list mt-3">
                    <li><i class="fas fa-check-circle"></i>Source code</li>
                    <li><i class="fas fa-check-circle"></i>Documentation</li>
                    <li><i class="fas fa-check-circle"></i>Commercial use</li>
                  </ul>

                  <a href="{% url 'marketplace:buy_now' product.slug %}" class="btn btn-netflix-primary w-100 mt-3">
                    <i class="fas fa-shopping-cart me-2"></i>Buy Now
                  </a>
                </div>
              </div>

              <!-- Rent & Host -->
              <div class="col-md-6">
                <div class="pd-price-card alt">
                  <div class="pc-ico alt"><i class="fas fa-server"></i></div>
                  <h4 class="mb-1">Rent & Host</h4>
                  <p class="small mb-3" style="color: var(--netflix-light-gray);">
                    We set it up and host it for you.
                  </p>

                  <div class="pc-price">
                    ₦{{ product.rental_setup_fee|floatformat:0 }}
                  </div>

                  <div class="small mt-1" style="color: var(--netflix-light-gray);">
                    {% if product.starting_monthly_price %}
                      + ₦{{ product.starting_monthly_price.monthly_price|floatformat:0 }}/month
                      <span class="d-block">({{ product.starting_monthly_price.name }} plan)</span>
                    {% else %}
                      Hosting plan required
                    {% endif %}
                  </div>

                  <ul class="pc-list mt-3">
                    <li><i class="fas fa-check-circle"></i>Setup & deployment</li>
                    <li><i class="fas fa-check-circle"></i>Managed hosting</li>
                    <li><i class="fas fa-check-circle"></i>Updates support</li>
                  </ul>

                  <a href="/plans/{{ product.slug }}/rent" class="btn btn-netflix-secondary w-100 mt-3">
                    <i class="fas fa-rocket me-2"></i>Rent Now
                  </a>
                </div>
              </div>
            </div>

            <!-- Secondary actions -->
            <div class="d-flex gap-3 mt-4">
              <button type="button" class="btn btn-netflix-secondary flex-fill" id="shareProduct">
                <i class="fas fa-share-alt me-2"></i>Share
              </button>
              <a class="btn btn-netflix-secondary flex-fill" target="_blank"
                 href="https://wa.me/2348102712103?text=Hi,%20I%20have%20a%20question%20about%20{{ product.title|urlencode }}">
                <i class="fab fa-whatsapp me-2"></i>Ask on WhatsApp
              </a>
            </div>

          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Tabs -->
  <section class="py-5">
    <div class="container">
      <div class="netflix-card">
        <ul class="nav nav-tabs pd-tabs mb-4" role="tablist">
          <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#pd-desc" type="button">
              <i class="fas fa-align-left me-2"></i>Description
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#pd-feat" type="button">
              <i class="fas fa-list-check me-2"></i>Features
            </button>
          </li>
          <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#pd-support" type="button">
              <i class="fas fa-headset me-2"></i>Support
            </button>
          </li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane fade show active" id="pd-desc">
            <div class="pd-tab">
              {% if product.description %}
                <div class="pd-rich">{{ product.description|safe }}</div>
              {% else %}
                <p style="color: var(--netflix-light-gray);">
                  {{ product.title }} is a premium product built for speed, clean UI, and easy customization.
                </p>
              {% endif %}
            </div>
          </div>

          <div class="tab-pane fade" id="pd-feat">
            <div class="pd-tab">
              <div class="pd-features">
                <div class="f-card"><i class="fas fa-box"></i><h6>Complete Package</h6><p>Files + assets included</p></div>
                <div class="f-card"><i class="fas fa-book"></i><h6>Documentation</h6><p>Setup guide included</p></div>
                <div class="f-card"><i class="fas fa-sync"></i><h6>Updates</h6><p>Improvements over time</p></div>
                <div class="f-card"><i class="fas fa-tachometer-alt"></i><h6>Fast</h6><p>Optimized performance</p></div>
              </div>
            </div>
          </div>

          <div class="tab-pane fade" id="pd-support">
            <div class="pd-tab">
              <div class="pd-support">
                <div class="s-card">
                  <i class="fab fa-whatsapp"></i>
                  <h6>WhatsApp Support</h6>
                  <p>Quick help via WhatsApp.</p>
                </div>
                <div class="s-card">
                  <i class="fas fa-envelope"></i>
                  <h6>Email Support</h6>
                  <p>Replies within business hours.</p>
                </div>
                <div class="s-card">
                  <i class="fas fa-file-alt"></i>
                  <h6>Documentation</h6>
                  <p>Clear setup instructions included.</p>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

</div>

<style>
  .pd-wrap{ padding-top:80px; min-height:100vh; }

  .pd-breadcrumb{ background: rgba(255,255,255,0.03); border-bottom:1px solid var(--netflix-medium-gray); }
  .breadcrumb{ background:transparent; }
  .breadcrumb a{ color: var(--netflix-light-gray); text-decoration:none; }
  .breadcrumb a:hover{ color: var(--netflix-red); }
  .breadcrumb-item{ color: var(--netflix-light-gray); }
  .breadcrumb-item.active{ color: var(--netflix-white); }
  .breadcrumb-item+.breadcrumb-item::before{ content:"›"; color: var(--netflix-light-gray); }

  .pd-main{
    position: relative;
    border-radius: 14px;
    overflow:hidden;
    background: var(--netflix-dark-gray);
    border: 1px solid rgba(255,255,255,0.06);
    min-height: 380px;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .pd-main img{ width:100%; height:auto; display:block; object-fit:cover; }
  .pd-ph{ text-align:center; color: var(--netflix-light-gray); font-size:1.1rem; }
  .pd-ph i{ font-size:4rem; color: rgba(229,9,20,0.8); }

  .pd-badges{ position:absolute; top:16px; left:16px; display:flex; flex-direction:column; gap:.5rem; }

  .pd-mini{
    display:flex; gap:1rem; flex-wrap:wrap;
    padding: 1rem;
    border-radius: 14px;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--netflix-medium-gray);
  }
  .mini-item{ display:flex; align-items:center; gap:.6rem; color: var(--netflix-light-gray); font-size:.92rem; }
  .mini-item i{ color: #28a745; }

  .pd-cat{
    display:inline-flex; align-items:center;
    background: rgba(229,9,20,0.12);
    border: 1px solid rgba(229,9,20,0.25);
    color: var(--netflix-red);
    padding: .5rem 1rem;
    border-radius: 999px;
    font-weight: 800;
    font-size: .85rem;
    letter-spacing: .8px;
    text-transform: uppercase;
  }

  .pd-title{ font-weight: 900; line-height:1.15; }

  .pd-meta{ display:flex; gap:.75rem; flex-wrap:wrap; }
  .meta-pill{
    display:inline-flex; align-items:center;
    padding: .5rem .9rem;
    border-radius: 999px;
    background: rgba(255,255,255,0.04);
    border: 1px solid var(--netflix-medium-gray);
    color: var(--netflix-light-gray);
    font-size: .9rem;
  }

  .pd-price-card{
    height:100%;
    padding: 1.35rem;
    border-radius: 16px;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--netflix-medium-gray);
    transition: all .2s ease;
  }
  .pd-price-card:hover{ transform: translateY(-3px); border-color: rgba(229,9,20,0.35); }
  .pd-price-card.alt{ background: rgba(229,9,20,0.06); border-color: rgba(229,9,20,0.25); }

  .pc-ico{
    width: 46px; height:46px;
    border-radius: 14px;
    display:flex; align-items:center; justify-content:center;
    background: rgba(229,9,20,0.12);
    border: 1px solid rgba(229,9,20,0.25);
    color: var(--netflix-red);
    margin-bottom: .9rem;
    font-size: 1.15rem;
  }
  .pc-ico.alt{ background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.12); color: var(--netflix-white); }

  .pc-price{
    font-size: 1.6rem;
    font-weight: 950;
    color: var(--netflix-white);
    margin-top: .25rem;
  }

  .pc-list{ list-style:none; padding:0; margin:0; color: var(--netflix-light-gray); }
  .pc-list li{ display:flex; align-items:center; gap:.6rem; padding:.4rem 0; }
  .pc-list i{ color:#28a745; }

  .pd-tabs{ border-bottom: 2px solid var(--netflix-medium-gray); }
  .pd-tabs .nav-link{
    background: transparent; border:0;
    color: var(--netflix-light-gray);
    font-weight: 800;
    padding: 1rem 1.1rem;
  }
  .pd-tabs .nav-link.active{
    color: var(--netflix-white);
    background: rgba(229,9,20,0.12);
    border-radius: 10px;
  }

  .pd-tab{ padding: 1rem 0 0; }

  .pd-rich { color: var(--netflix-light-gray); }
  .pd-rich *{ color: inherit; }
  .pd-rich a{ color: var(--netflix-white); }

  .pd-features{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
  }
  .f-card{
    padding: 1.2rem;
    border-radius: 14px;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--netflix-medium-gray);
  }
  .f-card i{ color: var(--netflix-red); font-size: 1.2rem; }
  .f-card h6{ margin: .6rem 0 .25rem; font-weight: 900; }
  .f-card p{ margin:0; color: var(--netflix-light-gray); font-size:.95rem; }

  .pd-support{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
  }
  .s-card{
    padding: 1.2rem;
    border-radius: 14px;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--netflix-medium-gray);
  }
  .s-card i{ color: var(--netflix-red); font-size: 1.4rem; }
  .s-card h6{ margin: .6rem 0 .25rem; font-weight: 900; }
  .s-card p{ margin:0; color: var(--netflix-light-gray); }

  @media (max-width: 768px){
    .pd-wrap{ padding-top:70px; }
    .pd-title{ font-size: 2rem; }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const shareBtn = document.getElementById('shareProduct');

    if (shareBtn) {
      shareBtn.addEventListener('click', function () {
        const url = window.location.href;

        if (navigator.share) {
          navigator.share({
            title: '{{ product.title|escapejs }}',
            text: 'Check this out on LagosWebDev Marketplace',
            url
          });
        } else {
          navigator.clipboard.writeText(url).then(() => {
            const old = this.innerHTML;
            this.innerHTML = '<i class="fas fa-check me-2"></i>Link Copied!';
            setTimeout(() => this.innerHTML = old, 1500);
          });
        }
      });
    }
  });
</script>
{% endblock %}
